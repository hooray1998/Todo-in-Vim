"=================================================================
"		Vim-plug æ’ä»¶ç®¡ç†       
"=================================================================
call plug#begin('~/.vim/plugged')

" å¼‚æ­¥æ‰§è¡ŒShellçš„æ’ä»¶
Plug 'skywind3000/asyncrun.vim'

" ç¾åŒ–çŠ¶æ€æ å’Œæ ‡ç­¾é¡µ ä¸éœ€è¦å¯ä»¥æ³¨é‡Šæ‰
Plug 'vim-airline/vim-airline'
Plug 'vim-airline/vim-airline-themes'

" monokai theme" ä¸€ä¸ªä¸»é¢˜,ä¸ºäº†è¾¾åˆ°ç¤ºä¾‹ä¸Šçš„é«˜äº®å½©è‰²ä¸»é¢˜ "
Plug 'patstockwell/vim-monokai-tasty'

call plug#end()

"==================================================================
" æ˜¾ç¤ºç›¸å…³  
"==================================================================
"ç¦ç”¨é—ªçƒå’Œå“é“ƒ
set vb t_vb=
"ç¦ç”¨æœç´¢é«˜äº®
set nohlsearch
syntax on
set nu
set shiftwidth=4
set go=             " ä¸è¦å›¾å½¢æŒ‰é’®  
autocmd InsertLeave * se nocul  " ç”¨æµ…è‰²é«˜äº®å½“å‰è¡Œ  
autocmd InsertEnter * se cul    " ç”¨æµ…è‰²é«˜äº®å½“å‰è¡Œ  
set showcmd         " è¾“å…¥çš„å‘½ä»¤æ˜¾ç¤ºå‡ºæ¥ï¼Œçœ‹çš„æ¸…æ¥šäº›  
set laststatus=2    " å¯åŠ¨æ˜¾ç¤ºçŠ¶æ€è¡Œ(1),æ€»æ˜¯æ˜¾ç¤ºçŠ¶æ€è¡Œ(2)  

"ç¼–ç "
set fencs=utf-8,ucs-bom,shift-jis,gb18030,gbk,gb2312,cp936
set termencoding=utf-8
set encoding=utf-8
set fileencodings=ucs-bom,utf-8,cp936
set fileencoding=utf-8

"==================================================================
"	å®ç”¨è®¾ç½®
"==================================================================

set nocompatible              " å»é™¤VIä¸€è‡´æ€§,å¿…é¡»è¦æ·»åŠ 

"å…è®¸æ’ä»¶  
"é€šè¿‡% å®ç°XMLæ ‡ç­¾çš„è·³è½¬"
set nocompatible
runtime macros/matchit.vim
set clipboard+=unnamed "å…±äº«å‰ªè´´æ¿  
set nobackup "ä»ä¸å¤‡ä»½  
set autoread " è®¾ç½®å½“æ–‡ä»¶è¢«æ”¹åŠ¨æ—¶è‡ªåŠ¨è½½å…¥
set autowrite "è‡ªåŠ¨ä¿å­˜
set ruler					" æ˜¾ç¤ºçŠ¶æ€æ æ ‡å°º"
set cursorline              " çªå‡ºæ˜¾ç¤ºå½“å‰è¡Œ
set magic                   " è®¾ç½®é­”æœ¯
set guioptions-=T           " éšè—å·¥å…·æ 
set guioptions-=m           " éšè—èœå•æ 
" è®¾ç½®åœ¨çŠ¶æ€è¡Œæ˜¾ç¤ºçš„ä¿¡æ¯
set foldenable              " å¼€å§‹æŠ˜å 
set foldcolumn=0
set foldmethod=indent 
set foldlevel=3 
set foldlevelstart=99
set completeopt=preview,menu "ä»£ç è¡¥å…¨ 
set wildmode=full " è®¾å®šè¡¥å…¨è¡Œä¸º"

set confirm " åœ¨å¤„ç†æœªä¿å­˜æˆ–åªè¯»æ–‡ä»¶çš„æ—¶å€™ï¼Œå¼¹å‡ºç¡®è®¤
set autoindent " è‡ªåŠ¨ç¼©è¿›
set cindent
set tabstop=4 " Tabé”®çš„å®½åº¦
set softtabstop=4 " ç»Ÿä¸€ç¼©è¿›ä¸º4
set shiftwidth=4
set noexpandtab " ä¸è¦ç”¨ç©ºæ ¼ä»£æ›¿åˆ¶è¡¨ç¬¦
set smarttab " åœ¨è¡Œå’Œæ®µå¼€å§‹å¤„ä½¿ç”¨åˆ¶è¡¨ç¬¦
set history=1000 " å†å²è®°å½•æ•°
set noswapfile
set ignorecase "æœç´¢å¿½ç•¥å¤§å°å†™
set smartcase " å¦‚æœæœ‰ä¸€ä¸ªå¤§å†™å­—æ¯ï¼Œåˆ™åˆ‡æ¢åˆ°å¤§å°å†™æ•æ„ŸæŸ¥æ‰¾
set incsearch "æœç´¢é€å­—ç¬¦é«˜äº®
set gdefault "è¡Œå†…æ›¿æ¢
set langmenu=zh_CN.UTF-8 "è¯­è¨€è®¾ç½®
set helplang=cn
set cmdheight=1 " å‘½ä»¤è¡Œï¼ˆåœ¨çŠ¶æ€è¡Œä¸‹ï¼‰çš„é«˜åº¦ï¼Œé»˜è®¤ä¸º1ï¼Œè¿™é‡Œæ˜¯2
set viminfo+=!  " ä¿å­˜å…¨å±€å˜é‡
set iskeyword+=_,$,@,%,#,- " å¸¦æœ‰å¦‚ä¸‹ç¬¦å·çš„å•è¯ä¸è¦è¢«æ¢è¡Œåˆ†å‰²
set linespace=0 " å­—ç¬¦é—´æ’å…¥çš„åƒç´ è¡Œæ•°ç›®
set wildmenu " å¢å¼ºæ¨¡å¼ä¸­çš„å‘½ä»¤è¡Œè‡ªåŠ¨å®Œæˆæ“ä½œ
set backspace=2 " ä½¿å›æ ¼é”®ï¼ˆbackspaceï¼‰æ­£å¸¸å¤„ç†indent, eol, startç­‰
set whichwrap+=<,>,h,l " å…è®¸backspaceå’Œå…‰æ ‡é”®è·¨è¶Šè¡Œè¾¹ç•Œ
set mouse=a " å¯ä»¥åœ¨bufferçš„ä»»ä½•åœ°æ–¹ä½¿ç”¨é¼ æ ‡ï¼ˆç±»ä¼¼officeä¸­åœ¨å·¥ä½œåŒºåŒå‡»é¼ æ ‡å®šä½ï¼‰
set selection=exclusive
set selectmode=mouse,key
set report=0 " é€šè¿‡ä½¿ç”¨: commandså‘½ä»¤ï¼Œå‘Šè¯‰æˆ‘ä»¬æ–‡ä»¶çš„å“ªä¸€è¡Œè¢«æ”¹å˜è¿‡
set fillchars=vert:\ ,stl:\ ,stlnc:\			"åœ¨è¢«åˆ†å‰²çš„çª—å£é—´æ˜¾ç¤ºç©ºç™½ï¼Œä¾¿äºé˜…è¯»
set showmatch " é«˜äº®æ˜¾ç¤ºåŒ¹é…çš„æ‹¬å·
set matchtime=1 " åŒ¹é…æ‹¬å·é«˜äº®çš„æ—¶é—´ï¼ˆå•ä½æ˜¯ååˆ†ä¹‹ä¸€ç§’ï¼‰
set scrolloff=3 " å…‰æ ‡ç§»åŠ¨åˆ°bufferçš„é¡¶éƒ¨å’Œåº•éƒ¨æ—¶ä¿æŒ3è¡Œè·ç¦»
set smartindent " ä¸ºCç¨‹åºæä¾›è‡ªåŠ¨ç¼©è¿›
filetype plugin indent on 

"=================================================================
"	airline options
"=================================================================

if !exists('g:airline_symbols')
	let g:airline_symbols = {}
endif

" powerline symbols
let g:airline_left_sep = 'î‚°'
let g:airline_left_alt_sep = 'î‚±'
let g:airline_right_sep = '' "'î‚²'
let g:airline_right_alt_sep = 'î‚³'
let g:airline_symbols.branch = 'î‚ '
let g:airline_symbols.readonly = 'î‚¢'
let g:airline_symbols.linenr = 'â˜°'
let g:airline_symbols.maxlinenr = 'î‚¡'

let g:airline_section_b = '%{strftime("%c")}'
let g:airline_section_c = ''
let g:airline_section_x = ''
let g:airline_section_y = ''
let g:airline_section_error = ''
let g:airline_section_warning = ''
let g:airline_powerline_fonts=1

set laststatus=2 "1ä¸ºå…³é—­åº•éƒ¨çŠ¶æ€æ  2ä¸ºå¼€å¯"
set t_Co=256     "ç»ˆç«¯å¼€å¯256è‰²æ”¯æŒ"
set ambiwidth=double "é˜²æ­¢ç‰¹æ®Šç¬¦å·æ— æ³•æ­£å¸¸æ˜¾ç¤º
let g:airline#extensions#tabline#enabled=1 "é¡¶éƒ¨tabæ˜¾ç¤º
"let g:airline_theme='bubblegum'  "murmuré…è‰²ä¹Ÿä¸é”™


set background=dark " è®¾ç½®é…è‰²æ–¹æ¡ˆ
"let g:vim_monokai_tasty_italic = 1 "åŠ ä¸Šè¿™å¥å æ³¨é‡Šä¼šæœ‰åº•è‰²ï¼Œå¾ˆä¸‘"
colorscheme vim-monokai-tasty
let g:lightline = { 'colorscheme': 'monokai_tasty', }
let g:airline_theme='monokai_tasty'

"=================================================================
" è‡ªåŠ¨æ˜¾ç¤ºéšè—åŒæ­¥æ—¶çš„quickfixçª—å£"
augroup vimrc
	autocmd User AsyncRunStart call asyncrun#quickfix_toggle(1, 1)
augroup END
"=================================================================
"	å¿«æ·é”®æ˜ å°„ç›¸å…³å‡½æ•°
"=================================================================

func Settitle() 
	call setline(1,"\$ ".expand("%:t:r").expand("-Todo"))
	call append(line("."),"") 
	call append(line(".")+1, "	@ First List") 
    normal G$
endfunc 
func GitPush() 
	" ä¸Šä¼ åˆ°äº‘ç«¯
	call system("git add --all")
	call system("git commit -m \"`whoami` @  `hostname` in `date +%y-%m-%d=%H:%M:%S`\"")
	exec ":AsyncRun git push origin master"
endfunc 
func GitPull() 
	" è·å–äº‘ç«¯æœ€æ–°ç‰ˆ
	exec ":cd %:h"
	.normal 
	exec ":AsyncStop"
	exec ":AsyncRun git pull origin master"  
	autocmd User AsyncRunStop exec ":ccl"
	autocmd User AsyncRunStop exec ":e %"
endfunc 
func AtPullEnd()
endfunc
func CheckOrUncheck()
	" é€‰ä¸­æˆ–å–æ¶ˆé€‰ä¸­
	.normal "ayy
	let loc_k=match(@a,"â˜")
	let loc_g=match(@a,"âœ”")
	"åŒæ—¶é€‰ä¸­å­ä¸»é¢˜
	if loc_k>-1
		.normal 0fâ˜sâœ”j
		.normal ""yy
		let k=match(@","â˜")
		let g=match(@","âœ”")
		while k>loc_k || g>loc_k
			if k>loc_k
				.normal 0fâ˜sâœ”j""yy
				let k=match(@","â˜")
				let g=match(@","âœ”")
			else
				let k=-1
				let g=-1
			endif
		endwhile
		.normal `b
	elseif loc_g>-1
		.normal 0fâœ”sâ˜`b
	else
		.normal j
	endif
endfunc
func NewLine()
	if match(@r,"@")>-1
		.normal >>Iâ˜ l
	elseif match(@r,"â˜")>-1
		.normal Iâ˜ l
	elseif match(@r,"âœ”")>-1
		.normal Iâ˜ l
	endif
endfunc
func CheckAllChild()
	.normal "ryy
	let loc = match(@r,"â˜")
	if loc>-1
	else
		.normal j
	endif
endfunc

"=================================================================
"	é”®ç›˜å‘½ä»¤
"=================================================================

"è®¾ç½®<leader>ä¸ºç©ºæ ¼é”®
let mapleader="\<Space>"

" åˆ‡æ¢Buffer"
nnoremap <Tab> :bn<CR>
nnoremap <S-Tab> :bp<CR>
" åˆ é™¤å½“å‰Buffer"
nnoremap <leader>x :bd %<CR><CR>

"C-l æ¸…é™¤é«˜äº®
nnoremap <silent> <C-l> :<C-u>nohlsearch<CR><C-l>

"H,Lç§»åŠ¨åˆ°è¡Œé¦–è¡Œå°¾
map H ^
map L $
"å¯è§†æ¨¡å¼ä¸‹ç§»åŠ¨åˆ°è¡Œå°¾
vnoremap L $h

"ä¿å­˜æ–‡ä»¶  ======> åŒæ—¶ä¸Šä¼ todoåˆ°äº‘ç«¯
nnoremap <leader>w :w<CR><CR>
nnoremap <leader>e :wqall<CR>
"å¿«æ·å¤åˆ¶ç²˜è´´è‡³ç³»ç»Ÿ
nnoremap <C-A> ggVG"+y<CR>


"=================================================================
"	for TODO å¿«æ·é”®
"=================================================================

" normal æ¨¡å¼å¿«æ·é”®
"=================================================================
nnoremap <Enter> mb:call  CheckOrUncheck()<CR>
nnoremap * maA â˜…`a
nnoremap # maA â˜…`a
nnoremap <Backspace> :.s/ â˜…//g<CR>
nnoremap o "ryyo.:call NewLine()<CR>a
nnoremap O Oâ˜ 
nnoremap <C-j> /^\s*@/e<CR>
nnoremap <C-k> ?^\s*@?e<CR>
nnoremap J /^\s*@/e<CR>
nnoremap K ?^\s*@?e<CR>
nnoremap <C-n> :edit 
nnoremap <C-z> u


" insert æ¨¡å¼å¿«æ·é”®
"=================================================================

" å›åˆ°æ­£å¸¸æ¨¡å¼
inoremap jj 
inoremap kk 
inoremap jk 
inoremap kj 
inoremap ;; 

" æ”¹å˜ç¼©è¿›
inoremap <Tab> .ma>>`ala
inoremap <S-Tab> ma<<`aa
" ç¼–è¾‘ä¸‹ä¸€è¡Œ
inoremap <Enter> "ryya.:call NewLine()<CR>a

"=================================================================
" Todoå¼‚æ­¥æ›´æ–°
"=================================================================

autocmd BufRead,BufNewFile *.todo set filetype=todo
"æ¯æ¬¡å¯åŠ¨Todoæ—¶éƒ½å…ˆæœ€æ–°ç‰ˆ"
autocmd VimEnter *.todo call GitPull()
"ä¿å­˜æ–‡ä»¶æ—¶è‡ªåŠ¨å­˜å‚¨è¯¥ç‰ˆæœ¬"
autocmd bufwritepost *.todo call GitPush() 
"æ–°å»ºæ–‡ä»¶è‡ªåŠ¨æ’å…¥æ–‡ä»¶å¤´ 
autocmd BufNewFile *.todo call Settitle()
